!function(t,e,i,n){var o=function(){var t=function(t){this.getDraggedItemPosition=t};return t.prototype={exec:function(t,e){var i,n,o,a,r,h,l=e.aspect_ratio,s=e.vertical_spacing,c=this.getColumns(e),f=c.length,u=Math.floor(c[0].width/l),g=0,m=0,p=function(){g++,g>=f&&(g=0,m++)};for(i=0;i<t.length;i++)n=t[i],n.isDragged||(o=c[g].width,a=u,h=(u+s)*m,r=c[g].left,n.placement={width:o,height:a,top:h,left:r,col:g,row:m},p());return[{no:1,vertOffset:0,items:t}]},getColumns:function(t){var e,i=t.horizontal_spacing,n=t.container_width,o="xs"===t.screen_size?1:t.column_count,a=[],r=n-i*(o-1),h=Math.floor(r/o),l=r-h*o,s=0;for(e=0;e<o;e++){var c=0;l>0&&(c=1,l--),a[e]={width:h+c,left:s},s+=h+i+c}return a}},t}(),a=function(){function t(t,e,i){var n,o=t.length;for(n=0;n<o;n++){var a=t[n];if(a.col===e&&a.row===i)return!0}return!1}function e(t,e,i,n,o){var a,r;for(a=0;a<e;a++)for(r=0;r<i;r++)t.push({col:n+a,row:o+r})}var i=function(t){this.getDraggedItemCells=t};return i.prototype={exec:function(i,n){var o,a,r,h,l,s,c,f,u=n.aspect_ratio,g=n.horizontal_spacing,m=n.vertical_spacing,p=this.getColumns(n),v=p.length,d=Math.floor(p[0].width/u),w=[],_={col:0,row:0},y={col:0,row:0};for(o=0;o<i.length;o++){var b=i[o];if(!b.isDragged){var x=b.params,$=x.h_span?parseInt(x.h_span):1,G=x.v_span?parseInt(x.v_span):1;for("xs"===n.screen_size&&($=1,G=1),$=$>v?v:$,h=!1,y={col:_.col,row:_.row};!h;){if(h=!0,y.col+$>v&&(h=!1),h)for(a=0;a<$;a++)for(r=0;r<G;r++)(y.col+a>=v||t(w,y.col+a,y.row+r))&&(h=!1);h||(y.col++,y.col>=v&&(y.col=0,y.row++))}for(e(w,$,G,y.col,y.row),l=0,a=y.col;a<y.col+$;a++)l+=p[a].width;for(l+=g*($-1),s=d*G+m*(G-1),f=(d+m)*y.row,c=p[y.col].left,b.placement={width:l,height:s,top:f,left:c,col:y.col,row:y.row},h=!1;!h;)t(w,_.col,_.row)?(_.col++,_.col>=v&&(_.col=0,_.row++)):h=!0}}return[{no:1,vertOffset:0,items:i}]},getColumns:function(t){var e,i=t.horizontal_spacing,n=t.container_width,o="xs"===t.screen_size?1:t.column_count,a=[],r=n-i*(o-1),h=Math.floor(r/o),l=r-h*o,s=0;for(e=0;e<o;e++){var c=0;l>0&&(c=1,l--),a[e]={width:h+c,left:s},s+=h+i+c}return a}},i}(),r=function(){function t(t){var e,i=t.horizontal_spacing,n=t.container_width,o="xs"===t.screen_size?1:t.column_count,a=[],r=n-i*(o-1),h=Math.floor(r/o),l=r-h*o,s=0;for(e=0;e<o;e++){var c=0;l>0&&(c=1,l--),a[e]={no:e,width:h,extraPixel:c,height:0,netHeight:0,left:s,items:[],pageItemsCount:0},s+=h+i+c}return a}function e(t){var e,i=t.length,n=t[0].height,o=t[0];for(e=1;e<i;e++){var a=t[e].height;a<n&&(n=a,o=t[e])}return o}function i(t){var e,i,n=t.length,o=t[0].height;for(e=0;e<n;e++){var a=t[e].height;a>0&&a<o&&(o=a)}for(e=0;e<n;e++){var r=t[e].items,h=t[e].height,l=h-o;if(0!==l){var s=0,c=t[e].netHeight,f=r.length;for(i=0;i<f;i++){var u=r[i],g=Math.ceil(u.placement.height*l/c);l-=g,c-=u.placement.height,u.placement.height-=g,u.placement.top-=s,s+=g}}}}var n=function(t){this.editorCallback=t};return n.prototype.exec=function(n,o){var a,r,h,l,s,c,f,u=o.vertical_spacing,g=o.align_bottom,m=1,p=t(o);f=n.length;var v=-1;for(c=0;c<f;c++){v++;var d=n[c];a=e(p),r=a.width,h=Math.floor(d.thumbnail_height/d.thumbnail_width*r);var w=a.extraPixel;s=a.height,l=a.left,d.placement={pageNo:m,width:r+w,height:h,top:s,left:l,col:a.no},a.items.push(d),a.pageItemsCount++,a.height+=h+u,a.netHeight+=h}return g&&i(p),[{no:1,vertOffset:0,items:n}]},n}(),h=function(){var i=640,n=t(e),h=function(e){this.$el=t(e),this.$container=this.$el.find(".vls-gf-container"),this.layoutParams={},this.settings={},this.items=[],this.init()};return h.prototype={init:function(){var t=this.$el,e=this;if(this.$el.removeClass("no-js"),this.layoutParams=t.data("vlsGfLayout"),this.settings=t.data("vlsGfSettings"),"grid"===this.layoutParams.layout_type)this.calculator=new o;else if("metro"===this.layoutParams.layout_type)this.calculator=new a;else{if("masonry-v"!==this.layoutParams.layout_type)return void console.log("Gallery Factory error: unknown layout type");this.calculator=new r}this.initItems(),this.updateLayout(),n.bind("resize",function(){e.updateLayout()})},initItems:function(){var e=this.items;this.$el.find(".vls-gf-item").each(function(){var i=t(this),n=i.data("vlsGfLayout")||{},o=parseInt(i.data("vlsGfThumbnailWidth")),a=parseInt(i.data("vlsGfThumbnailHeight"));e.push({$el:i,params:n,thumbnail_width:o,thumbnail_height:a})})},updateLayout:function(n){var o=this.layoutParams;o.container_width=this.$el.find(".vls-gf-container").innerWidth(),t(e).width()<=i?o.screen_size="xs":o.screen_size="lg",this.layout=this.calculator.exec(this.items,this.layoutParams),this.showPage(),n||o.container_width==this.$el.find(".vls-gf-container").innerWidth()||this.updateLayout(!0)},showPage:function(){var e=this,i=0;t.each(this.layout[0].items,function(t,n){n.$el.css({top:n.placement.top,left:n.placement.left,width:n.placement.width,height:n.placement.height}).removeClass("vls-gf-hidden"),e.centerImage(n);var o=n.placement.top+n.placement.height;i<o&&(i=o)}),this.$container.css({height:i}),this.initLightbox()},centerImage:function(t){var e,i,n,o=t.$el.find(".vls-gf-img"),a=t.$el.innerWidth(),r=t.$el.innerHeight();t.thumbnail_width/t.thumbnail_height>a/r?(e=Math.ceil(t.thumbnail_width/t.thumbnail_height*r-a),i=Math.floor(e/2),n=e-i,o.css({top:0,bottom:0,left:-i,right:-n})):(e=Math.ceil(t.thumbnail_height/t.thumbnail_width*a-r),i=Math.floor(e/2),n=e-i,o.css({top:-i,bottom:-n,left:0,right:0}))},initLightbox:function(){var t=this.$el.data("vlsGfLightbox");t&&"function"==typeof t.updateTargets&&t.updateTargets(this.$el,!1)}},h}();t.fn.vlsGfGallery=function(){return this.each(function(){var e=new h(this);t.data(this,"vlsGfGallery",e)}),this},t(function(){t(".vls-gf-gallery").vlsGfGallery()})}(jQuery,window,document);